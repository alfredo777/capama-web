<script type="text/javascript" src="/assets/html2canvas.js"></script>
<script type="text/javascript" src="/assets/canvas2image.js"></script>
<div class="first-head"></div>
<img src="/assets/heads/head1v2.png" width="100%">
<div class="ahead-head"> Impresi√≥n de formulario</div>
<div class="container-ajax" style="text-align: justify;">
  <div class="offset"></div>
  <div class="btn btn-green" id="format-print">Imprimir formato</div>
  <div class="light-wrapper">
    <div class="container inner" style="margin-top:-70px;">
      <div class="thin">
        <div id="printing">
          <style type="text/css">
          .printing-form{
          border: solid 1px #010101;
          padding: 30px;
          min-height: 900px;
          }
          .printing-form-title{
          text-align:  center;
          font-size: 20px;
          width: 85%;
          float:left;
          
          }
          .folio-form-printing{
          float: left;
          font-size: 7px;
          padding: 4px;
          border: solid 1px;
          width: 15%;
          margin-top: -27px;
          margin-right: 0px;
          }
          .container-form{
          border: solid 1px #eee;
          }
          .izquierdo-mid {
          width: 48%;
          float:left;
          margin-top: 20px;
          min-height: 90px;
          font-size: 10px;
          }
          .derecho-mid {
          width: 48%;
          float:right;
          margin-top: 20px;
          min-height: 90px;
          font-size: 10px;
          }
          .completo{
          float: left;
          width: 100%;
          margin-top: 30px;
          min-height: 50px;
          font-size: 10px;
          }
          table.barby-barcode { border-spacing: 0; }
          tr.barby-row {}
          td.barby-cell { width: 3px; height: 50px; }
          td.barby-cell.on { background: #000; }
          </style>
          <div class="printing-form">
            <div class="printing-form-title">
              <img alt="Logo v 3" src="/assets/admin/logo-v-3.png" width="120px" style="float:left;">
              <%= @form.title %>
            </div>
            <div class="folio-form-printing" ><div id="barcode">
            <%= raw @barcode_for_html.to_html %>
             <center><%= params[:form_sender] %></center>
             </div></div>
            <div style="border-bottom: solid 1px; widht:100%; position: relative; margin-top: 60px;"></div>
            
            <div class="container-form">
              <% @questions.each do |q| %>
              <div class="<%= q.qclass%>" >
               <b> <%= q.qtag %>: </b><br/>
                <% respqx = q.question_responses.where(form_sender: params[:form_sender]) %>
                <% respqx.each do |r| %>
                <%= r.question_value %> | 
                <%end%>
              </div>
              <%end%>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="btn btn-green" id="format-print">Imprimir formato</div>

</div>
<script type="text/javascript">
  $(document).ready(function(){
     html2canvas($("#barcode"), {
        onrendered: function(canvas) {
            theCanvas = canvas;
            document.body.appendChild(canvas);

            // Convert and download as image 
            //Canvas2Image.saveAsPNG(canvas); 
            $("#barcode").html(convertCanvasToImage(canvas));
            // Clean up 
            //document.body.removeChild(canvas);
        }
    });

    function convertCanvasToImage(canvas) {
      var image = new Image();
      image.src = canvas.toDataURL("image/png");
      return image;
    }

    $("#format-print").click(function(){

      
       var url = "/printing_view_format?form_sender="+"<%=params[:form_sender]%>";
       var divElements = $("#printing").html();
       document.body.innerHTML = divElements ;
       window.print();
       window.location = url
    });
  });
</script>